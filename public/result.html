    <!doctype html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>MyScheduling</title>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
        <link href="css/styles.css" rel="stylesheet" />
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <nav class="navbar navbar-expand-lg bg-body-tertiary navbar-light bg-light static-top">
            <div class="container-fluid">
            <a class="navbar-brand" href="index.html">MyScheduling</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="index.html">Home</a>
                
                </li>
                <li class="my_page">
                    <a class="nav-link" href="data.html">오늘의 기록</a>
                </li>
                <li class="my_page">
                    <a class="nav-link" href="result.html">기록 확인</a>
                </li>
                </ul>
                <a class="btn btn-primary" href="/logout">로그아웃</a>
            </div>
            </div>
        </nav>
    <div fragment="content" class="container">
        
        <h5 class="my-3 border-bottom pb-2">식단 정보</h5>
        <form id="dateForm" method="POST" action="/dataResult">
            <label for="datepicker">날짜를 선택하세요 : </label>
            <input type="date" name="selectedDate" id="datepicker" max="2120-07-30" min="2000-10-05">
            <input type="submit" value="불러오기" class="btn btn-primary my-2">
            
        </form>
        <canvas id="myChart-mealenergy"></canvas>
        <div fragment="content" class="card my-3" id="notmealenergy" style="display: none;">
        <div class="card-body">
        <div class="card-text" style=" white-space: pre-line;" >칼로리가 부족합니다.</div>
        <div class="card-text" style=" white-space: pre-line;" >칼로리는 우리 몸의 에너지 공급원입니다. 곡물류(밀, 쌀, 귀리 등), 감자, 고구마, 견과류, 그리고 고단백질 식품(고기, 생선, 계란, 콩 등)은 칼로리 공급에 좋습니다.</div>

    </div>
    </div>
        <canvas id="myChart-mealprotein"></canvas>
        <div fragment="content" class="card my-3"id="notmealprotein" style="display: none;">
        <div class="card-body">
        <div class="card-text" style="white-space: pre-line;" >단백질이 부족합니다.</div>
        <div class="card-text" style="white-space: pre-line;" >단백질은 우리 몸의 세포를 구성하고, 세포의 성장과 복제를 돕습니다. 고기(소고기, 닭고기, 돼지고기 등), 해산물(생선, 조개류, 새우 등), 유제품(우유, 치즈, 요구르트 등), 그리고 콩과 콩제품(두부, 청국장, 된장 등)에 단백질이 풍부합니다.</div>
    </div>
    </div>
        <canvas id="myChart-mealFiber"></canvas>
        <div fragment="content" class="card my-3" id="notmealFiber" style="display: none;"">
            <div class="card-body">
            <div class="card-text" style="white-space: pre-line;" >식이섬유가 부족합니다.</div>
            <div class="card-text" style="white-space: pre-line;" >식이섬유는 소화를 돕고, 포만감을 주어 체중 관리에 도움이 됩니다. 채소류(브로콜리, 케일, 시금치 등), 과일류(사과, 배, 오렌지 등), 콩과 콩제품, 그리고 견과류(아몬드, 호두, 피스타치오 등)에 식이섬유가 풍부합니다.</div>
        </div>
        </div>
        <canvas id="myChart-mealfolicacid"></canvas>
        <div fragment="content" class="card my-3" id="notmealfolicacid" style="display: none;">
            <div class="card-body">
            <div class="card-text" style="white-space: pre-line;" >엽산이 부족합니다.</div>
            <div class="card-text" style="white-space: pre-line;" >엽산은 적혈구 생성과 세포의 성장을 돕습니다. 잎이 녹색인 채소(시금치, 브로콜리 등), 곡류, 콩과 콩제품, 그리고 과일(오렌지, 바나나 등)에 엽산이 많이 들어있습니다.</div>
        </div>
        </div>
        <canvas id="myChart-mealcalcium"></canvas>
        <div fragment="content" class="card my-3" id="notmealcalcium" style="display: none;">
            <div class="card-body">
            <div class="card-text" style="white-space: pre-line;" >칼슘이 부족합니다.</div>
            <div class="card-text" style="white-space: pre-line;" >칼슘은 뼈와 치아를 건강하게 유지하는데 필요합니다. 유제품(우유, 치즈, 요구르트 등), 작은 뼈가 들어있는 생선(정어리, 멸치 등), 그리고 잎이 녹색인 채소(브로콜리, 시금치 등)에 칼슘이 풍부합니다.</div>
        </div>
        </div>
        <canvas id="myChart-mealsalt"></canvas>
        <div fragment="content" class="card my-3"id="notmealsalt" style="display: none;">
            <div class="card-body">
            <div class="card-text" style="white-space: pre-line;" >나트륨이 부족합니다.</div>
            <div class="card-text" style="white-space: pre-line;" >나트륨은 체액의 밸런스를 유지하고, 신경과 근육의 기능을 돕습니다. 그러나 과다 섭취는 혈압 상승을 유발할 수 있으므로 주의해야 합니다. 일반적으로 가공식품, 인스턴트 식품, 그리고 짠 음식에 나트륨이 많이 들어있습니다.</div>
        </div>
        </div>
        <canvas id="myChart-mealiron"></canvas>
        <div fragment="content" class="card my-3" id="notmealiron" style="display: none;">
            <div class="card-body">
            <div class="card-text" style="white-space: pre-line;" >철분이 부족합니다.</div>
            <div class="card-text" style="white-space: pre-line;" >철분은 적혈구 생성에 필요하며, 산소를 운반하는 데 중요한 역할을 합니다. 고기(특히 간), 해산물, 콩과 콩제품, 그리고 잎이 녹색인 채소에 철분이 풍부합니다.</div>
        </div>
        </div>
        <canvas id="myChart-mealzinc"></canvas>
        <div fragment="content" class="card my-3" id="notmealzinc" style="display: none;">
            <div class="card-body">
            <div class="card-text" style="white-space: pre-line;" >아연이 부족합니다.</div>
            <div class="card-text" style="white-space: pre-line;" >아연은 면역 기능을 유지하고, 세포의 성장과 복제를 돕습니다. 해산물(굴, 새우, 조개류 등), 고기, 견과류, 그리고 콩과 콩제품에 아연이 풍부합니다.</div>
        </div>
        </div>
        
        </div>
        
        <script> 
        let myCharts = {};
        document.querySelector('#dateForm').addEventListener('submit', async (event) => {
        event.preventDefault();
    
        const selectedDate = document.querySelector('#datepicker').value;
        const res = await fetch('/dataResult', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: `selectedDate=${selectedDate}`
        });
        const rawData = await res.json();
    
        const labels = rawData.map(item => `${item.mealmoment}(${item.mealname})`);
        const labelMap = {
          'mealenergy': '칼로리',
          'mealprotein': '단백질',
          'mealFiber':'식이섬유',
          'mealfolicacid': '엽산',
          'mealcalcium': '칼슘',
          'mealsalt': '나트륨',
          'mealiron': '철분',
          'mealzinc': '아연'
        };
    
        const keys = ['mealenergy', 'mealprotein','mealFiber', 'mealfolicacid', 'mealcalcium', 'mealsalt', 'mealiron', 'mealzinc'];
        
        keys.forEach((key, index) => {
            const ctx = document.getElementById(`myChart-${key}`).getContext('2d');
            
            if (myCharts[key]) {
            myCharts[key].destroy();
            myCharts[key] = null;
        }

        setTimeout(()=>{myCharts[key] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: labelMap[key],
                        data: rawData.map(item => item[key]),
                        backgroundColor: `rgba(${255 - index * 25}, ${99 + index * 15}, ${132 + index * 10}, 0.2)`,
                        borderColor: `rgba(${255 - index * 25}, ${99 + index * 15}, ${132 + index * 10}, 1)`,
                        borderWidth: 1
                    }]
                },
                options: {
                  scales: {
                      yAxes: [{
                          type: 'linear',
                      }],
                  }
                }
            });
        },0);
            
            
        });
        const nutrientStandards = {
            mealenergy: { threshold: 2600},
            mealprotein: { threshold: 55},
            mealFiber: { threshold: 25},
            mealfolicacid: { threshold: 400},
            mealcalcium: { threshold:  750},
            mealsalt: { threshold: 2},
            mealiron: { threshold: 10},
            mealzinc: { threshold: 10 }
            
        };

    
        Object.keys(nutrientStandards).forEach(key => {
            
            const totalNutrient = rawData.reduce((sum, item) => sum + item[key], 0);
            const element = document.querySelector(`#not${key}`);
            if (totalNutrient < nutrientStandards[key].threshold) {
                element.style.display = 'block';
            } else {
                element.style.display = 'none';
            }
        });
    });
        
        
        // 페이지를 시작했을때 입력에 오늘 기준으로 하도록 설정 하기 위한 jscode

        document.addEventListener('DOMContentLoaded', function() {
            var today = new Date();
            var day = today.getDate();
            var month = today.getMonth() + 1;
            var year = today.getFullYear();
    
            var formattedDate = year + '-' + (month < 10 ? '0' : '') + month + '-' + (day < 10 ? '0' : '') + day;
   
            document.getElementById('datepicker').value = formattedDate;
        });

       
        
        
        </script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="js/scripts.js"></script>
</body>
</html>